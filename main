// ==UserScript==
// @name         WJX-Auto-Fill
// @namespace    http://tampermonkey.net/
// @version      2024-12-04
// @description  a script for wjx table filling
// @author       Arcolaus
// @match        https://www.wjx.cn/vm/*.aspx
// @grant        none


// ==/UserScript==

(function() {
    'use strict';
    // 定义问题和答案的字典
    const answers = {
        "姓名": "",
        "学号": "",
        "专业": "",
        "手机号": "",
        "是否参与提问": "",
    };

    function getQuestionDiv(selector) {
        const questionDivs = document.querySelectorAll(selector);

        // 遍历所有问题div元素,每个div中如果有class类型为ui-input-text的div，则为填空题，否则为单选题
        for (const questionDiv of questionDivs) {
            const inputLabelDiv = questionDiv.querySelector("div.ui-input-text");
            console.log("chk")

            // 填空题
            if (inputLabelDiv) {

                // 获取问题文本field-label，根据问题文本获取答案，并在ui-input-text中的input标签中填入答案
                const question = questionDiv.querySelector("div.field-label > div.topichtml").innerText;
                const answer = getAnswer(question);
                if (answer) {
                    const input = inputLabelDiv.querySelector("input");
                    input.value = answer;
                }
            }
            // 单选题
            else {
                // 获取问题文本field-label，根据问题文本获取答案，并在ui-controlgroup column1中选择答案
                const question = questionDiv.querySelector("div.field-label > div.topichtml").innerText;
                const answer = getAnswer(question);
                if (answer) {
                    const options = questionDiv.querySelectorAll("div.ui-controlgroup.column1 > div.ui-radio");
                    for (const option of options) {
                        if (option.innerText.includes(answer)) {
                            option.click();
                        }
                    }
                }
            }
        }
    }


    // 根据answers字典正则关键词匹配问题并返回答案
    function getAnswer(question) {
        for (const key in answers) {
            if (question.includes(key)) {
                return answers[key];
            }
        }
        alert("未找到答案：" + question);
        return null;
    }


    window.onload = () => {
        console.log("问卷星自动填写脚本已启动");
        // 调用getQuestionDiv函数，传入问题div的class名称为field ui-field-contain
        getQuestionDiv("div.field.ui-field-contain");
    };
})();
